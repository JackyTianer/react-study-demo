<!DOCTYPE html>
<html>
<head lang="zh-cmn-Hans">
  <meta charset="UTF-8">
  <title></title>
  <script src="http://cdn.bootcss.com/react/0.14.0-alpha1/react.js"></script>
  <script src="http://cdn.bootcss.com/react/0.14.0-alpha1/JSXTransformer.js"></script>
</head>
<body>
  <div id="content"></div>
</body>


<script type="text/jsx">

  var TodoItem = React.createClass({
    getInitialState: function() {
      return {
        isEdit: false,
        text: this.props.children[0],
        date: this.props.children[2]
      }
    },

    changeItem: function() {
      // TODO
    },

    update: function(index) {
      this.setState({isEdit: true });
    },

    render: function() {
      return(
              <li>
                <span>
                  {this.state.text}
                  <br/>
                  {this.state.date}
                </span>
                <button  onClick={this.update.bind(this, this.props.index)}>修改</button>
                <br/>
                <input type="text"
                       style={{display:(this.state.isEdit ? 'inline' : 'none')}}
                       value={this.state.text}
                       onChange={this.changeItem}
                        />
              </li>
      )
    }
  });

  var TodoList = React.createClass({
    getInitialState: function() {
      return {
        value:'',
        data:[
        {
          text: 'hello',
          date: '2014/12/12 上午12:12:34'
        },{
          text: 'world',
          date: '2015/2/1 上午10:28:54'
        }]
      };
    },
    changeItem: function (e) {
      this.setState({
        value: e.target.value
      });
    },
    submitItem: function(e) {
      this.state.data.push({
        text:this.state.value,
        date: new Date().toLocaleString()
      });
      this.setState({data: this.state.data, value: ''});
    },
    render: function() {
      var todoItems = this.state.data.map(function(item, index) {
        return(
                <TodoItem key={index} index={index}>
                  {item.text}
                  <br/>
                  {item.date}
                </TodoItem>
        )
      }) ;
      return (
              <div>
                <ul>
                  {todoItems}
                </ul>
                <input value={this.state.value} onChange={this.changeItem}/>
                <button onClick={this.submitItem} >提交</button>
              </div>
      )
    }
  });
  React.render(<TodoList></TodoList>, document.getElementById('content'));
</script>
</html>